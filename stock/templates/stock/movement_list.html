{% extends "base.html" %}
{% block content %}
<div class="container mt-4">
  <h2>ðŸ“¦ Liste des mouvements</h2>
  <div class="mb-3">
    <a href="{% url 'stock:movement_create' %}" class="btn btn-success">âž• Nouveau mouvement</a>
    <a href="{% url 'stock:product_list' %}" class="btn btn-success">liste Des Produits</a>
    <a href="{% url 'stock:export_xlsx' %}" class="btn btn-primary">ðŸ“¥ Export Excel</a>
  </div>
  <form method="get" class="form-inline mb-3">
  <select name="product" class="form-control mr-2">
    <option value="">â€” Produit â€”</option>
    {% for p in all_products %}
      <option value="{{ p.id }}" {% if selected_product == p.id|stringformat:"s" %}selected{% endif %}>
        {{ p.name }}
      </option>
    {% endfor %}
  </select>

  <select name="movement_type" class="form-control mr-2">
    <option value="">â€” Type â€”</option>
    <option value="IN" {% if selected_movement_type == 'IN' %}selected{% endif %}>EntrÃ©e</option>
    <option value="OUT" {% if selected_movement_type == 'OUT' %}selected{% endif %}>Sortie</option>
  </select>

  <button type="submit" class="btn btn-primary">Filtrer</button>
  <a href="{% url 'stock:movement_list' %}" class="btn btn-secondary ml-2">RÃ©initialiser</a>
</form>

  <table class="table table-striped">
    <thead>
      <tr>
        <th>Date</th>
        <th>Produit</th>
        <th>Type</th>
        <th>QuantitÃ©</th>
        <th>Note</th>
        <th>Actions</th>
      </tr>
    </thead>
    <tbody>
      {% for m in movements %}
      <tr>
        <td>{{ m.date|date:"d/m/Y H:i" }}</td>
        <td>{{ m.product.name }}</td>
        <td>{{ m.get_movement_type_display }}</td>
        <td>{{ m.movement_quantity }}</td>
        <td>{{ m.note }}</td>
        <td>
          <a href="{% url 'stock:movement_update' m.pk %}" class="btn btn-sm btn-primary">Modifier</a>
          <a href="{% url 'stock:movement_delete' m.pk %}" class="btn btn-sm btn-danger">Supprimer</a>
          <a href="{% url 'stock:movement_detail' m.pk %}" class="btn btn-sm btn-secondary">DÃ©tails</a>
        </td>
      </tr>
      {% empty %}
      <tr>
        <td colspan="6">Aucun mouvement enregistrÃ©.</td>
      </tr>
      {% endfor %}
    </tbody>
  </table>

  {% if is_paginated %}
  <nav aria-label="Page navigation">
    <ul class="pagination">
      {% if page_obj.has_previous %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.previous_page_number }}">PrÃ©cÃ©dent</a></li>
      {% endif %}
      {% for num in paginator.page_range %}
      <li class="page-item {% if page_obj.number == num %}active{% endif %}">
        <a class="page-link" href="?page={{ num }}">{{ num }}</a>
      </li>
      {% endfor %}
      {% if page_obj.has_next %}
      <li class="page-item"><a class="page-link" href="?page={{ page_obj.next_page_number }}">Suivant</a></li>
      {% endif %}
    </ul>
  </nav>
  {% endif %}
</div>
{% endblock %}
