{% extends "base.html" %}

{% block content %}
<div class="container mt-4">
  <h1 class="mb-3">Détails de la facture</h1>

  <div class="card shadow-sm mb-3">
    <div class="card-body">
      <p><strong>Patient :</strong> {{ billing.appointment.patient }}</p>
      <p><strong>Médecin :</strong> {{ billing.appointment.medecin.get_full_name }}</p>
      <p><strong>Montant :</strong> {{ billing.amount }} €</p>
      <p><strong>Date émission :</strong> {{ billing.issued_at|date:"d/m/Y H:i" }}</p>
      <p>
        <strong>État :</strong>
        {% if billing.paid %}
          <span class="badge bg-success">Payée</span>
        {% else %}
          <span class="badge bg-danger">Impayée</span>
        {% endif %}
      </p>
    </div>
  </div>

  <a href="{% url 'billing:billing_list' %}" class="btn btn-secondary">Retour</a>

    {% if billing_template %}
     <!-- Bouton pour générer le document dynamique -->
        <a href="{% url 'documents:create_document' billing_template.id %}?billing_id={{ billing.id }}"
        class="btn btn-primary ms-2">
        Générer facture PDF personnalisée
        </a>
    {% else %}
        <div class="alert alert-warning mt-3 d-flex justify-content-between align-items-center">
          <span>Aucun modèle de facture n’a encore été défini.</span>
            {% if user.role == "admin" %}
                <a href="{% url 'documents:create_template' %}?doc_type=billing"
                 class="btn btn-sm btn-outline-success">
                ➕ Créer un modèle de facture
                </a>
            {% endif %}
         </div>
    {% endif %}

</div>
{% endblock %}
